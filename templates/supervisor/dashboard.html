{% extends "base.html" %}

{% block title %}Supervisor Dashboard - Workforce Scheduler{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Header with Crew Filter -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Supervisor Dashboard</h1>
        <div class="btn-group" role="group">
            <a href="{{ url_for('supervisor.set_crew', crew='all') }}" 
               class="btn {{ 'btn-primary' if selected_crew == 'all' else 'btn-outline-primary' }}">All Crews</a>
            <a href="{{ url_for('supervisor.set_crew', crew='A') }}" 
               class="btn {{ 'btn-primary' if selected_crew == 'A' else 'btn-outline-primary' }}">Crew A</a>
            <a href="{{ url_for('supervisor.set_crew', crew='B') }}" 
               class="btn {{ 'btn-primary' if selected_crew == 'B' else 'btn-outline-primary' }}">Crew B</a>
            <a href="{{ url_for('supervisor.set_crew', crew='C') }}" 
               class="btn {{ 'btn-primary' if selected_crew == 'C' else 'btn-outline-primary' }}">Crew C</a>
            <a href="{{ url_for('supervisor.set_crew', crew='D') }}" 
               class="btn {{ 'btn-primary' if selected_crew == 'D' else 'btn-outline-primary' }}">Crew D</a>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <i class="bi bi-people fs-1 text-primary mb-2"></i>
                    <h5 class="card-title">Total Employees</h5>
                    <h2 class="text-primary">{{ employees_count }}</h2>
                    <small class="text-muted">
                        {% if selected_crew != 'all' %}
                            Crew {{ selected_crew }}
                        {% else %}
                            All Crews
                        {% endif %}
                    </small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <i class="bi bi-calendar-x fs-1 text-warning mb-2"></i>
                    <h5 class="card-title">Pending Time Off</h5>
                    <h2 class="text-warning">{{ pending_time_off }}</h2>
                    {% if pending_time_off > 0 %}
                    <a href="{{ url_for('supervisor.time_off_requests', crew=selected_crew) }}" 
                       class="btn btn-sm btn-warning mt-2">Review Requests</a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <i class="bi bi-arrow-left-right fs-1 text-info mb-2"></i>
                    <h5 class="card-title">Pending Swaps</h5>
                    <h2 class="text-info">{{ pending_swaps }}</h2>
                    {% if pending_swaps > 0 %}
                    <!-- FIXED: Changed from shift_swap_requests to shift_swaps -->
                    <a href="{{ url_for('supervisor.shift_swaps', crew=selected_crew) }}" 
                       class="btn btn-sm btn-info mt-2">Review Swaps</a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <i class="bi bi-graph-up fs-1 text-success mb-2"></i>
                    <h5 class="card-title">Coverage</h5>
                    <h2 class="text-success">Good</h2>
                    <small class="text-muted">Current status</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="h4 mb-3">Quick Actions</h2>
        </div>
        <div class="col-md-6 mb-3">
            <a href="{{ url_for('supervisor.time_off_requests', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-calendar-check action-icon"></i>
                <h5>Time Off Requests</h5>
                <p class="text-muted mb-0">
                    {% if pending_time_off %}
                        <span class="badge bg-warning">{{ pending_time_off }} pending</span>
                        {% if selected_crew != 'all' %}
                            - Crew {{ selected_crew }}
                        {% endif %}
                    {% else %}
                        No pending requests
                    {% endif %}
                </p>
            </a>
        </div>
        <div class="col-md-6 mb-3">
            <!-- FIXED: Changed from shift_swap_requests to shift_swaps -->
            <a href="{{ url_for('supervisor.shift_swaps', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-arrow-left-right action-icon"></i>
                <h5>Shift Swaps</h5>
                <p class="text-muted mb-0">
                    {% if pending_swaps %}
                        <span class="badge bg-warning">{{ pending_swaps }} pending</span>
                        {% if selected_crew != 'all' %}
                            - Crew {{ selected_crew }}
                        {% endif %}
                    {% else %}
                        No pending swaps
                    {% endif %}
                </p>
            </a>
        </div>
    </div>

    <!-- Management Sections -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="h4 mb-3">Employee Management</h2>
        </div>
        <div class="col-md-4 mb-3">
            <a href="{{ url_for('supervisor.employees', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-people action-icon"></i>
                <h5>View Employees</h5>
                <p class="text-muted mb-0">
                    {% if selected_crew != 'all' %}
                        Crew {{ selected_crew }} members
                    {% else %}
                        All employees
                    {% endif %}
                </p>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <!-- FIXED: Changed underscore to hyphen to match route definition -->
            <a href="{{ url_for('supervisor.employee-management', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-person-gear action-icon"></i>
                <h5>Employee Management</h5>
                <p class="text-muted mb-0">Manage employee details</p>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <a href="{{ url_for('supervisor.crew-management', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-people-fill action-icon"></i>
                <h5>Crew Management</h5>
                <p class="text-muted mb-0">Organize crew assignments</p>
            </a>
        </div>
    </div>

    <!-- Schedule Management -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="h4 mb-3">Schedule Management</h2>
        </div>
        <div class="col-md-4 mb-3">
            <a href="{{ url_for('supervisor.schedules', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-calendar-week action-icon"></i>
                <h5>View Schedules</h5>
                <p class="text-muted mb-0">Current week schedules</p>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <a href="/schedule/select" class="action-card">
                <i class="bi bi-calendar-plus action-icon"></i>
                <h5>Create Schedule</h5>
                <p class="text-muted mb-0">Generate new schedules</p>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <a href="{{ url_for('supervisor.coverage-gaps', crew=selected_crew) }}" class="action-card">
                <i class="bi bi-exclamation-triangle action-icon"></i>
                <h5>Coverage Gaps</h5>
                <p class="text-muted mb-0">Identify staffing issues</p>
            </a>
        </div>
    </div>

    <!-- Data Management -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="h4 mb-3">Data Management</h2>
        </div>
        <div class="col-md-4 mb-3">
            <a href="/upload-employees" class="action-card">
                <i class="bi bi-file-earmark-excel action-icon"></i>
                <h5>Import Employees</h5>
                <p class="text-muted mb-0">Upload Excel files</p>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <a href="/upload-overtime" class="action-card">
                <i class="bi bi-clock-history action-icon"></i>
                <h5>Import Overtime</h5>
                <p class="text-muted mb-0">13-week history</p>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <a href="/upload-history" class="action-card">
                <i class="bi bi-clock-fill action-icon"></i>
                <h5>Upload History</h5>
                <p class="text-muted mb-0">View past uploads</p>
            </a>
        </div>
    </div>

    <!-- Recent Activity -->
    {% if recent_requests %}
    <div class="row">
        <div class="col-12">
            <h2 class="h4 mb-3">Recent Activity</h2>
            <div class="card">
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        {% for request in recent_requests[:5] %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ request.employee }}</strong>
                                <span class="text-muted">
                                    {% if request.type == 'time_off' %}
                                        requested time off
                                    {% else %}
                                        requested shift swap
                                    {% endif %}
                                </span>
                            </div>
                            <div>
                                <span class="badge bg-{{ 'success' if request.status == 'approved' else 'warning' if request.status == 'pending' else 'danger' }}">
                                    {{ request.status.title() }}
                                </span>
                                <small class="text-muted ms-2">{{ request.date }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.action-card {
    display: block;
    padding: 1.5rem;
    background: #fff;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    text-decoration: none;
    color: #212529;
    transition: all 0.2s ease-in-out;
    height: 100%;
}

.action-card:hover {
    background: #f8f9fa;
    border-color: #0d6efd;
    text-decoration: none;
    color: #212529;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.action-icon {
    font-size: 2rem;
    color: #0d6efd;
    margin-bottom: 0.5rem;
}
</style>
{% endblock %}

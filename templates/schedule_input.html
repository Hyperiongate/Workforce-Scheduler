<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Schedule - Workforce Scheduler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Workforce Scheduler</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/schedule/create">Create Schedule</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/employees">Employees</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <h2><i class="bi bi-calendar-plus"></i> Create Schedule</h2>
        
        <div class="row mt-4">
            <!-- Schedule Creation Form -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Schedule Details</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/schedule/create">
                            <!-- Date Range Selection -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="start_date" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="start_date" name="start_date" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="end_date" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="end_date" name="end_date" required>
                                </div>
                            </div>

                            <!-- Shift Template Selection -->
                            <div class="mb-3">
                                <label class="form-label">Select Shift Pattern</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="shift_pattern" id="standard" value="standard" checked>
                                    <label class="btn btn-outline-primary" for="standard">
                                        <i class="bi bi-sun"></i> Standard (8-5)
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="shift_pattern" id="two_shift" value="two_shift">
                                    <label class="btn btn-outline-primary" for="two_shift">
                                        <i class="bi bi-sunrise"></i> Two Shifts
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="shift_pattern" id="three_shift" value="three_shift">
                                    <label class="btn btn-outline-primary" for="three_shift">
                                        <i class="bi bi-moon-stars"></i> Three Shifts
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="shift_pattern" id="custom" value="custom">
                                    <label class="btn btn-outline-primary" for="custom">
                                        <i class="bi bi-gear"></i> Custom
                                    </label>
                                </div>
                            </div>

                            <!-- Shift Times (shown based on selection) -->
                            <div id="shiftTimes" class="mb-4">
                                <div class="row" id="shift1">
                                    <div class="col-md-4">
                                        <label class="form-label">Shift 1</label>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="time" class="form-control" name="shift1_start" value="08:00">
                                    </div>
                                    <div class="col-md-4">
                                        <input type="time" class="form-control" name="shift1_end" value="17:00">
                                    </div>
                                </div>
                            </div>

                            <!-- Position Requirements -->
                            <h6 class="mb-3">Position Requirements per Shift</h6>
                            <div id="positionRequirements">
                                {% for position in positions %}
                                <div class="row mb-2">
                                    <div class="col-md-4">
                                        <label class="form-label">{{ position.name }}</label>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="input-group">
                                            <span class="input-group-text">Employees needed:</span>
                                            <input type="number" class="form-control" name="position_{{ position.id }}_count" 
                                                   min="0" value="0" placeholder="0">
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                            <!-- Advanced Options -->
                            <div class="accordion mt-4" id="advancedOptions">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#collapseOne">
                                            <i class="bi bi-gear"></i>&nbsp; Advanced Options
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#advancedOptions">
                                        <div class="accordion-body">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="autoAssign" name="auto_assign" checked>
                                                <label class="form-check-label" for="autoAssign">
                                                    Automatically assign employees based on availability
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="fairRotation" name="fair_rotation" checked>
                                                <label class="form-check-label" for="fairRotation">
                                                    Ensure fair rotation of weekend/evening shifts
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="skillMatch" name="skill_match" checked>
                                                <label class="form-check-label" for="skillMatch">
                                                    Match employee skills with position requirements
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="overtimeCheck" name="overtime_check" checked>
                                                <label class="form-check-label" for="overtimeCheck">
                                                    Flag potential overtime (40+ hours/week)
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-magic"></i> Generate Schedule
                                </button>
                                <button type="button" class="btn btn-secondary btn-lg ms-2" onclick="previewSchedule()">
                                    <i class="bi bi-eye"></i> Preview
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Column - Overtime Analysis -->
            <div class="col-md-4">
                <!-- Overtime Eligible Employees -->
                <div class="card">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0 text-dark">
                            <i class="bi bi-clock-history"></i> Overtime Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <h6>Employees Near Overtime (35+ hrs)</h6>
                        <div class="list-group">
                            {% for employee in employees_near_overtime %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <strong>{{ employee.name }}</strong>
                                    <span class="badge bg-warning text-dark">{{ employee.current_hours }} hrs</span>
                                </div>
                                <small class="text-muted">
                                    {{ 40 - employee.current_hours }} hours until overtime
                                </small>
                                <div class="progress mt-1" style="height: 5px;">
                                    <div class="progress-bar bg-warning" style="width: {{ (employee.current_hours/40)*100 }}%"></div>
                                </div>
                            </div>
                            {% else %}
                            <p class="text-muted">No employees near overtime this week</p>
                            {% endfor %}
                        </div>

                        <hr>

                        <h6>Overtime Eligible Employees</h6>
                        <p class="text-muted">Employees available for overtime if needed:</p>
                        <div class="list-group">
                            {% for employee in overtime_eligible %}
                            <div class="list-group-item">
                                <strong>{{ employee.name }}</strong>
                                <div class="small">
                                    Current: {{ employee.current_hours }} hrs
                                    {% if employee.max_hours_per_week > 40 %}
                                        <span class="badge bg-success">Max: {{ employee.max_hours_per_week }} hrs</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Staffing Tips -->
                <div class="card mt-3">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-lightbulb"></i> Scheduling Tips
                        </h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li>Consider employee availability first</li>
                            <li>Rotate weekend shifts fairly</li>
                            <li>Match skills to position requirements</li>
                            <li>Check for overtime before finalizing</li>
                            <li>Leave buffer for unexpected absences</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Handle shift pattern changes
        document.querySelectorAll('input[name="shift_pattern"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const shiftTimes = document.getElementById('shiftTimes');
                shiftTimes.innerHTML = '';
                
                switch(this.value) {
                    case 'standard':
                        addShiftRow(1, '08:00', '17:00');
                        break;
                    case 'two_shift':
                        addShiftRow(1, '06:00', '14:00');
                        addShiftRow(2, '14:00', '22:00');
                        break;
                    case 'three_shift':
                        addShiftRow(1, '06:00', '14:00');
                        addShiftRow(2, '14:00', '22:00');
                        addShiftRow(3, '22:00', '06:00');
                        break;
                    case 'custom':
                        addShiftRow(1, '09:00', '17:00');
                        addCustomShiftButton();
                        break;
                }
            });
        });

        function addShiftRow(num, startTime, endTime) {
            const shiftTimes = document.getElementById('shiftTimes');
            const row = document.createElement('div');
            row.className = 'row mb-2';
            row.innerHTML = `
                <div class="col-md-4">
                    <label class="form-label">Shift ${num}</label>
                </div>
                <div class="col-md-4">
                    <input type="time" class="form-control" name="shift${num}_start" value="${startTime}">
                </div>
                <div class="col-md-4">
                    <input type="time" class="form-control" name="shift${num}_end" value="${endTime}">
                </div>
            `;
            shiftTimes.appendChild(row);
        }

        function addCustomShiftButton() {
            const shiftTimes = document.getElementById('shiftTimes');
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'btn btn-sm btn-outline-primary mt-2';
            button.innerHTML = '<i class="bi bi-plus"></i> Add Another Shift';
            button.onclick = function() {
                const shiftCount = shiftTimes.querySelectorAll('.row').length;
                addShiftRow(shiftCount + 1, '09:00', '17:00');
            };
            shiftTimes.appendChild(button);
        }

        function previewSchedule() {
            // Preview functionality - could open a modal or new page
            alert('Schedule preview would show here with the selected parameters');
        }

        // Set default dates
        document.getElementById('start_date').valueAsDate = new Date();
        const endDate = new Date();
        endDate.setDate(endDate.getDate() + 6);
        document.getElementById('end_date').valueAsDate = endDate;
    </script>
</body>
</html>

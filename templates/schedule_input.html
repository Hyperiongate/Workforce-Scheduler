<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Schedule - Workforce Scheduler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .employee-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .employee-card.selected {
            border-color: #0d6efd;
            background-color: #e7f1ff;
        }
        .skill-badge {
            font-size: 0.75rem;
            margin: 2px;
        }
        .schedule-preview {
            max-height: 500px;
            overflow-y: auto;
        }
        .shift-slot {
            border: 2px dashed #dee2e6;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            min-height: 60px;
        }
        .shift-slot.filled {
            border-style: solid;
            border-color: #198754;
            background-color: #f8f9fa;
        }
        .pattern-card {
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
        }
        .pattern-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .pattern-card.selected {
            border-color: #0d6efd;
            border-width: 2px;
            background-color: #e7f1ff;
        }
        .pattern-details {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-calendar3"></i> Workforce Scheduler
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/schedule/create">
                            <i class="bi bi-calendar-plus"></i> Create Schedule
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/vacation/calendar">
                            <i class="bi bi-calendar-week"></i> Calendar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">
                            <i class="bi bi-box-arrow-right"></i> Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <h2><i class="bi bi-calendar-plus"></i> Create Schedule</h2>
                <p class="text-muted">Build your team's schedule with smart assignment and overtime tracking</p>
            </div>
        </div>
        
        <div class="row mt-4">
            <!-- Main Schedule Creation Form -->
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-calendar-range"></i> Schedule Builder
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="scheduleForm" method="POST" action="/schedule/create">
                            <!-- Date Range Selection -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label for="start_date" class="form-label">
                                        <i class="bi bi-calendar-event"></i> Start Date
                                    </label>
                                    <input type="date" class="form-control" id="start_date" name="start_date" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="end_date" class="form-label">
                                        <i class="bi bi-calendar-event-fill"></i> End Date
                                    </label>
                                    <input type="date" class="form-control" id="end_date" name="end_date" required>
                                </div>
                            </div>

                            <!-- Schedule Type Selection -->
                            <div class="mb-4">
                                <label class="form-label">
                                    <i class="bi bi-calendar3"></i> Schedule Type
                                </label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="schedule_type" id="standard_schedule" value="standard" checked>
                                    <label class="btn btn-outline-primary" for="standard_schedule">
                                        <i class="bi bi-building"></i><br>
                                        Standard<br>
                                        <small>Office Hours</small>
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="schedule_type" id="4_crew_rotation" value="4_crew_rotation">
                                    <label class="btn btn-outline-primary" for="4_crew_rotation">
                                        <i class="bi bi-arrow-repeat"></i><br>
                                        24/7 Coverage<br>
                                        <small>4-Crew Rotation</small>
                                    </label>
                                </div>
                            </div>

                            <!-- Standard Schedule Options -->
                            <div id="standardOptions" class="schedule-options">
                                <div class="card mb-4">
                                    <div class="card-header bg-secondary text-white">
                                        <h6 class="mb-0">Standard Schedule Pattern</h6>
                                    </div>
                                    <div class="card-body">
                                        <select class="form-select" name="shift_pattern">
                                            <option value="standard">Standard (9-5, Mon-Fri)</option>
                                            <option value="retail">Retail (Varied hours, includes weekends)</option>
                                            <option value="2_shift">2-Shift (Day/Evening)</option>
                                            <option value="3_shift">3-Shift (Day/Evening/Night)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 4-Crew Rotation Pattern Selection -->
                            <div id="crewRotationOptions" class="schedule-options" style="display: none;">
                                <div class="alert alert-info mb-4">
                                    <i class="bi bi-info-circle"></i> <strong>Current Crew Status:</strong><br>
                                    {% for crew, employees in employees_by_crew.items() %}
                                        <strong>Crew {{ crew }}:</strong> {{ employees|length }} employees<br>
                                    {% endfor %}
                                    <small class="text-muted">Ensure all 4 crews (A, B, C, D) have employees assigned before creating schedule.</small>
                                </div>

                                <!-- Pattern Cards Grid -->
                                <h5 class="mb-3">Select Rotation Pattern:</h5>
                                <div class="row g-3 mb-4">
                                    <!-- Pitman Pattern -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('pitman')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-calendar2-week"></i> Pitman (2-2-3)</h6>
                                                <p class="card-text small">Work 2, off 2, work 3 â€¢ 12-hour shifts</p>
                                                <span class="badge bg-success">Most Popular</span>
                                                <span class="badge bg-info">42 hrs/week avg</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Southern Swing -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('southern_swing')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-arrow-clockwise"></i> Southern Swing</h6>
                                                <p class="card-text small">Rotating 8-hour shifts â€¢ 4-week cycle</p>
                                                <span class="badge bg-warning text-dark">8-hour shifts</span>
                                                <span class="badge bg-secondary">Complex</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Fixed-Fixed -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('fixed_fixed')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-calendar-check"></i> Fixed-Fixed</h6>
                                                <p class="card-text small">Mon-Thu vs Fri-Sun crews â€¢ No rotation</p>
                                                <span class="badge bg-primary">Predictable</span>
                                                <span class="badge bg-info">Lifestyle choice</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- DuPont -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('dupont')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-calendar-range"></i> DuPont</h6>
                                                <p class="card-text small">4-week cycle â€¢ 7 consecutive days off</p>
                                                <span class="badge bg-success">Long breaks</span>
                                                <span class="badge bg-secondary">Complex</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 5&2 -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('five_and_two')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-grid-3x2"></i> 5&2 Schedule</h6>
                                                <p class="card-text small">Work 5, off 2 pattern variations â€¢ Fixed shifts</p>
                                                <span class="badge bg-info">12-hour shifts</span>
                                                <span class="badge bg-secondary">Complex</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 4-on-4-off -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('four_on_four_off')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-calendar2-week-fill"></i> 4-on-4-off</h6>
                                                <p class="card-text small">Work 4 days, off 4 days â€¢ Simple pattern</p>
                                                <span class="badge bg-success">Simple</span>
                                                <span class="badge bg-info">Balanced</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 3-on-3-off -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('three_on_three_off')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-calendar2-day"></i> 3-on-3-off</h6>
                                                <p class="card-text small">Work 3 days, off 3 days â€¢ 6-week cycle</p>
                                                <span class="badge bg-primary">Frequent breaks</span>
                                                <span class="badge bg-info">Popular</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Alternating Fixed -->
                                    <div class="col-md-6">
                                        <div class="card pattern-card h-100" onclick="selectPattern('alternating_fixed')">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="bi bi-calendar2-x"></i> Alternating Fixed</h6>
                                                <p class="card-text small">3-4-3-4 pattern â€¢ Semi-fixed schedule</p>
                                                <span class="badge bg-warning text-dark">Unique</span>
                                                <span class="badge bg-info">Balanced weekends</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pattern Details Section -->
                                <div id="patternDetails" class="pattern-details" style="display: none;">
                                    <h5><i class="bi bi-info-circle"></i> Pattern Configuration</h5>
                                    <div id="patternConfig">
                                        <!-- Pattern-specific configuration will be loaded here -->
                                    </div>
                                </div>

                                <!-- Hidden input for selected pattern -->
                                <input type="hidden" name="rotation_pattern" id="rotation_pattern" value="">
                                <input type="hidden" name="rotation_type" id="rotation_type" value="">
                                <input type="hidden" name="rotation_frequency" id="rotation_frequency" value="">
                                <input type="hidden" name="day_pattern" id="day_pattern" value="">
                                <input type="hidden" name="night_pattern" id="night_pattern" value="">
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                <button type="button" class="btn btn-secondary btn-lg" onclick="previewSchedule()">
                                    <i class="bi bi-eye"></i> Preview Schedule
                                </button>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-magic"></i> Generate Schedule
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Column - Helpers -->
            <div class="col-md-4">
                <!-- Available Employees -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-people-fill"></i> Available Employees
                        </h5>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        {% for employee in employees %}
                        <div class="employee-card card mb-2" data-employee-id="{{ employee.id }}">
                            <div class="card-body p-2">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <strong>{{ employee.name }}</strong>
                                        {% if employee.is_supervisor %}
                                            <span class="badge bg-primary">Supervisor</span>
                                        {% endif %}
                                        <br>
                                        <small class="text-muted">Crew: {{ employee.crew or 'Unassigned' }}</small>
                                        <div class="mt-1">
                                            {% for skill in employee.skills %}
                                                <span class="badge bg-secondary skill-badge">{{ skill.name }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-info">{{ employee.current_hours|default(0) }} hrs</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Pattern Info -->
                <div class="card mb-4" id="patternInfoCard" style="display: none;">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle"></i> Pattern Details
                        </h5>
                    </div>
                    <div class="card-body" id="patternInfoContent">
                        <!-- Pattern information will be loaded here -->
                    </div>
                </div>

                <!-- Tips -->
                <div class="card">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0 text-dark">
                            <i class="bi bi-lightbulb"></i> Pro Tips
                        </h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li>For 24/7 coverage, ensure all 4 crews are staffed</li>
                            <li>Fixed patterns allow different day/night schedules</li>
                            <li>Consider employee preferences for rotation frequency</li>
                            <li>Start schedules on Sunday to minimize overtime</li>
                            <li>Review pattern details before committing</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-eye"></i> Schedule Preview
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="schedulePreview" class="schedule-preview">
                        <!-- Preview content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitSchedule()">
                        <i class="bi bi-check-circle"></i> Create Schedule
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates (next Monday to Sunday)
            const today = new Date();
            const nextMonday = new Date(today);
            nextMonday.setDate(today.getDate() + (1 + 7 - today.getDay()) % 7);
            
            document.getElementById('start_date').valueAsDate = nextMonday;
            
            const nextSunday = new Date(nextMonday);
            nextSunday.setDate(nextMonday.getDate() + 6);
            document.getElementById('end_date').valueAsDate = nextSunday;
        });

        // Handle schedule type changes
        document.querySelectorAll('input[name="schedule_type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const standardOptions = document.getElementById('standardOptions');
                const crewRotationOptions = document.getElementById('crewRotationOptions');
                
                if (this.value === 'standard') {
                    standardOptions.style.display = 'block';
                    crewRotationOptions.style.display = 'none';
                } else {
                    standardOptions.style.display = 'none';
                    crewRotationOptions.style.display = 'block';
                }
            });
        });

        // Pattern selection
        function selectPattern(patternId) {
            // Remove previous selection
            document.querySelectorAll('.pattern-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.currentTarget.classList.add('selected');
            
            // Set hidden input
            document.getElementById('rotation_pattern').value = patternId;
            
            // Show pattern details
            showPatternDetails(patternId);
            
            // Show pattern info in sidebar
            showPatternInfo(patternId);
        }

        function showPatternDetails(patternId) {
            const detailsDiv = document.getElementById('patternDetails');
            const configDiv = document.getElementById('patternConfig');
            
            detailsDiv.style.display = 'block';
            
            // Clear previous config
            configDiv.innerHTML = '';
            
            switch(patternId) {
                case 'pitman':
                    configDiv.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">Pitman Variation</label>
                            <select class="form-select" name="pitman_variation" onchange="updateRotationType(this.value)">
                                <option value="fixed">Fixed - Crews never change shifts</option>
                                <option value="rapid">Rapid Rotation - Change after every break</option>
                                <option value="2_week">2-Week Rotation - 2 weeks days, 2 weeks nights</option>
                                <option value="4_week">4-Week Rotation - 4 weeks days, 4 weeks nights</option>
                            </select>
                            <small class="text-muted">Fixed allows different patterns for day/night crews</small>
                        </div>
                        <div id="fixedPatternOptions" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Day Crews (A & B) Pattern</label>
                                    <select class="form-select" name="day_crews_pattern">
                                        <option value="pitman">Pitman (2-2-3)</option>
                                        <option value="4_4">4-on-4-off</option>
                                        <option value="5_2">5&2</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Night Crews (C & D) Pattern</label>
                                    <select class="form-select" name="night_crews_pattern">
                                        <option value="pitman">Pitman (2-2-3)</option>
                                        <option value="4_4">4-on-4-off</option>
                                        <option value="5_2">5&2</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                
                case 'southern_swing':
                    configDiv.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i> <strong>8-Hour Shifts</strong><br>
                            This pattern uses 8-hour shifts rotating through days, evenings, and nights over 4 weeks.
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Shift Times</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="shift_times" value="standard" checked>
                                <label class="form-check-label">
                                    Standard: Day (7am-3pm), Evening (3pm-11pm), Night (11pm-7am)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="shift_times" value="custom">
                                <label class="form-check-label">
                                    Custom times (define your own)
                                </label>
                            </div>
                        </div>
                    `;
                    document.getElementById('rotation_type').value = 'rotating';
                    break;
                
                case 'fixed_fixed':
                    configDiv.innerHTML = `
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>Fixed Schedule - No Rotation</strong><br>
                            Crews A & B work Mon-Thu (48 hrs/week)<br>
                            Crews C & D work Fri-Sun (36 hrs/week)
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Shift Length</label>
                            <select class="form-select" name="fixed_fixed_hours">
                                <option value="12">12-hour shifts (standard)</option>
                                <option value="10">10-hour shifts</option>
                            </select>
                        </div>
                    `;
                    document.getElementById('rotation_type').value = 'fixed';
                    break;
                
                case 'dupont':
                    configDiv.innerHTML = `
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i> <strong>DuPont Schedule</strong><br>
                            Famous for 7 consecutive days off every 4 weeks!
                        </div>
                        <p>This is a rotating pattern with a complex 4-week cycle. All crews must follow the same pattern.</p>
                    `;
                    document.getElementById('rotation_type').value = 'rotating';
                    document.getElementById('rotation_frequency').value = '4_week';
                    break;
                
                case 'five_and_two':
                    configDiv.innerHTML = `
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>5&2 Schedule</strong><br>
                            Complex pattern with 4 different 2-week cycles
                        </div>
                        <p>Fixed shifts only - day crews and night crews follow different 5&2 patterns.</p>
                    `;
                    document.getElementById('rotation_type').value = 'fixed';
                    break;
                
                case 'four_on_four_off':
                    configDiv.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">4-on-4-off Variation</label>
                            <select class="form-select" name="four_variation" onchange="updateFourOnFourType(this.value)">
                                <option value="basic">Basic - Simple 4 on, 4 off</option>
                                <option value="split">Split Shift (2D-2N) - 2 days, break, 2 nights</option>
                                <option value="modified">Modified - Full weekends off</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Shift Type</label>
                            <select class="form-select" name="four_shift_type">
                                <option value="fixed">Fixed - Same shift always</option>
                                <option value="rotating">Rotating - Change periodically</option>
                            </select>
                        </div>
                    `;
                    break;
                
                case 'three_on_three_off':
                    configDiv.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">3-on-3-off Variation</label>
                            <select class="form-select" name="three_variation">
                                <option value="basic">Basic - Simple 3 on, 3 off</option>
                                <option value="modified">Modified - Full weekends off</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Shift Type</label>
                            <select class="form-select" name="three_shift_type">
                                <option value="fixed">Fixed - Same shift always</option>
                                <option value="rotating">Rotating - Change periodically</option>
                            </select>
                        </div>
                    `;
                    break;
                
                case 'alternating_fixed':
                    configDiv.innerHTML = `
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>Alternating Fixed (3-4-3-4)</strong><br>
                            Each crew works 3 core days + alternating 4th day
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Crew Assignments</label>
                            <p class="text-muted">
                                Crews A & C: Sun-Mon-Tue + alternating Wed<br>
                                Crews B & D: Thu-Fri-Sat + alternating Wed
                            </p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Shift Type</label>
                            <select class="form-select" name="alt_shift_type">
                                <option value="fixed">Fixed shifts</option>
                                <option value="rotating">Rotating between days/nights</option>
                            </select>
                        </div>
                    `;
                    break;
            }
        }

        function showPatternInfo(patternId) {
            const infoCard = document.getElementById('patternInfoCard');
            const infoContent = document.getElementById('patternInfoContent');
            
            infoCard.style.display = 'block';
            
            const patternInfo = {
                'pitman': {
                    name: 'Pitman (2-2-3)',
                    cycle: '14 days',
                    hours: '42 hrs/week average',
                    pros: ['Popular choice', 'Every other weekend off', 'Balanced work/life'],
                    cons: ['Can be confusing initially', 'Requires all 4 crews']
                },
                'southern_swing': {
                    name: 'Southern Swing',
                    cycle: '28 days',
                    hours: '40 hrs/week',
                    pros: ['8-hour shifts', 'Experience all shifts', 'Good for training'],
                    cons: ['Only 1 weekend off per month', 'Frequent shift changes']
                },
                'fixed_fixed': {
                    name: 'Fixed-Fixed',
                    cycle: 'No rotation',
                    hours: '48 hrs (Mon-Thu) or 36 hrs (Fri-Sun)',
                    pros: ['Completely predictable', 'Lifestyle choice', 'No shift changes'],
                    cons: ['Unequal hours', 'Weekend crews work every weekend']
                },
                'dupont': {
                    name: 'DuPont',
                    cycle: '28 days',
                    hours: '42 hrs/week average',
                    pros: ['7 consecutive days off', 'Popular in industry', 'Good work/life balance'],
                    cons: ['Complex pattern', 'Long work stretches']
                },
                'five_and_two': {
                    name: '5&2 Schedule',
                    cycle: '14 days (varies)',
                    hours: '42 hrs/week average',
                    pros: ['Predictable stretches', 'Fixed shifts'],
                    cons: ['Complex pattern', 'Different for each crew']
                },
                'four_on_four_off': {
                    name: '4-on-4-off',
                    cycle: '8 days',
                    hours: '42 hrs/week average',
                    pros: ['Simple pattern', 'Equal work/off days', 'Easy to remember'],
                    cons: ['Split weekends', 'Can be monotonous']
                },
                'three_on_three_off': {
                    name: '3-on-3-off',
                    cycle: '6 days',
                    hours: '42 hrs/week average',
                    pros: ['Frequent breaks', 'Never work more than 3 days', 'Popular'],
                    cons: ['More transitions', 'Split weekends']
                },
                'alternating_fixed': {
                    name: 'Alternating Fixed',
                    cycle: '14 days',
                    hours: '42 hrs/week average',
                    pros: ['Semi-predictable', 'Balanced weekends', 'Core days fixed'],
                    cons: ['Wednesday varies', 'Can be confusing']
                }
            };
            
            const info = patternInfo[patternId];
            
            infoContent.innerHTML = `
                <h6>${info.name}</h6>
                <p class="mb-2">
                    <strong>Cycle:</strong> ${info.cycle}<br>
                    <strong>Hours:</strong> ${info.hours}
                </p>
                <div class="mb-2">
                    <strong class="text-success">Pros:</strong>
                    <ul class="mb-0">
                        ${info.pros.map(pro => `<li><small>${pro}</small></li>`).join('')}
                    </ul>
                </div>
                <div>
                    <strong class="text-danger">Cons:</strong>
                    <ul class="mb-0">
                        ${info.cons.map(con => `<li><small>${con}</small></li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function updateRotationType(variation) {
            const fixedOptions = document.getElementById('fixedPatternOptions');
            const rotationType = document.getElementById('rotation_type');
            const rotationFreq = document.getElementById('rotation_frequency');
            
            if (variation === 'fixed') {
                fixedOptions.style.display = 'block';
                rotationType.value = 'fixed';
            } else {
                fixedOptions.style.display = 'none';
                rotationType.value = 'rotating';
                
                // Set rotation frequency based on variation
                if (variation === 'rapid') {
                    rotationFreq.value = 'rapid';
                } else if (variation === '2_week') {
                    rotationFreq.value = '2_week';
                } else if (variation === '4_week') {
                    rotationFreq.value = '4_week';
                }
            }
        }

        function updateFourOnFourType(variation) {
            if (variation === 'split') {
                alert('Split shift (2D-2N): Crews work 2 days, have 24-hour break, then work 2 nights, followed by 4 days off. This is challenging but popular!');
            } else if (variation === 'modified') {
                alert('Modified pattern moves shifts to create full weekends off. Results in 4 full weekends off out of 8.');
            }
        }

        function previewSchedule() {
            const modal = new bootstrap.Modal(document.getElementById('previewModal'));
            const preview = document.getElementById('schedulePreview');
            
            const scheduleType = document.querySelector('input[name="schedule_type"]:checked').value;
            const startDate = new Date(document.getElementById('start_date').value);
            const endDate = new Date(document.getElementById('end_date').value);
            
            let previewHTML = '<div class="alert alert-info">Schedule preview based on your selections:</div>';
            
            if (scheduleType === '4_crew_rotation') {
                const pattern = document.getElementById('rotation_pattern').value;
                previewHTML += `<h5>Pattern: ${pattern.replace(/_/g, ' ').toUpperCase()}</h5>`;
                previewHTML += '<p>This will create a complete rotation schedule for all 4 crews.</p>';
            } else {
                previewHTML += '<h5>Standard Schedule</h5>';
            }
            
            previewHTML += `<p><strong>Date Range:</strong> ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}</p>`;
            previewHTML += '<p class="text-muted">Click "Create Schedule" to generate the full schedule with employee assignments.</p>';
            
            preview.innerHTML = previewHTML;
            modal.show();
        }

        function submitSchedule() {
            // Validate crew rotation selection
            const scheduleType = document.querySelector('input[name="schedule_type"]:checked').value;
            if (scheduleType === '4_crew_rotation') {
                const pattern = document.getElementById('rotation_pattern').value;
                if (!pattern) {
                    alert('Please select a rotation pattern!');
                    return;
                }
            }
            
            document.getElementById('scheduleForm').submit();
        }
    </script>
</body>
</html>
